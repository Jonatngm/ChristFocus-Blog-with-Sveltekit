import{F as o,G as c}from"./DfM-zcOs.js";import{s as n}from"./DzKOTJ0Y.js";function l(r){var i;return{id:r.id,email:r.email,username:((i=r.user_metadata)==null?void 0:i.username)||r.email.split("@")[0]}}function f(){const{subscribe:r,set:i,update:e}=c({user:null,loading:!0});let g=!1;(async()=>{try{const{data:{session:t},error:a}=await n.auth.getSession();a&&console.error("Error getting session:",a),e(u=>({user:t!=null&&t.user?l(t.user):null,loading:!1})),g=!0}catch(t){console.error("Error initializing auth:",t),e(a=>({...a,loading:!1}))}})();const{data:m}=n.auth.onAuthStateChange(async(t,a)=>{console.log("Auth state changed:",t),t==="SIGNED_IN"&&(a!=null&&a.user)?e(u=>({user:l(a.user),loading:!1})):t==="SIGNED_OUT"?e(u=>({user:null,loading:!1})):t==="TOKEN_REFRESHED"&&(a!=null&&a.user)?e(u=>({user:l(a.user),loading:u.loading})):t==="INITIAL_SESSION"&&e(u=>({user:a!=null&&a.user?l(a.user):null,loading:!1}))});return{subscribe:r,login:t=>e(a=>({...a,user:t})),logout:()=>{n.auth.signOut(),e(t=>({...t,user:null}))},setLoading:t=>e(a=>({...a,loading:t}))}}const d=f();o(d,r=>r.user);o(d,r=>r.loading);export{d as a};
