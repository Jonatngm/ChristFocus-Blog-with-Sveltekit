import{f as k,a as f,t as pe}from"../chunks/DUlsYC3j.js";import{i as lt}from"../chunks/D1Mnw4Fy.js";import{o as nt}from"../chunks/gMiQyaKI.js";import{p as dt,l as Ee,c as ut,d as ct,e as pt,g as e,m as c,s as r,$ as vt,i as o,r as a,f as Fe,j as s,n as G,k as mt,u as U,t as L,o as gt}from"../chunks/DfM-zcOs.js";import{s as K,e as R}from"../chunks/Ce7UJ3xo.js";import{i as Q}from"../chunks/BxkL2RRF.js";import{h as ft,r as S,e as Z,i as ee,s as A}from"../chunks/pTKB1-Ql.js";import{b as bt,a as te,c as Me}from"../chunks/Dlfh-MLN.js";import{s as xt,a as je}from"../chunks/dSDtfX3-.js";import{g as Be}from"../chunks/5wH2ZyBx.js";import{p as _t}from"../chunks/DGyOTvZF.js";import{p as O}from"../chunks/DsqSX7aj.js";import{a as ht}from"../chunks/yMEJVJxs.js";import{B as ve}from"../chunks/BSl4I6XK.js";import{t as w}from"../chunks/zpaCH91C.js";import{R as yt}from"../chunks/DshLg9oX.js";import{X as Le}from"../chunks/B6aFb63J.js";var $t=k('<div class="flex items-center justify-center py-20"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div></div>'),wt=k('<div class="relative rounded-lg overflow-hidden border-2 border-input"><img class="w-full h-32 object-cover"/> <button type="button" class="absolute top-1 right-1 bg-destructive text-destructive-foreground p-1.5 rounded-full hover:bg-destructive/90 transition-colors"><!></button> <div class="absolute bottom-1 left-1 bg-black/70 text-white text-xs px-2 py-0.5 rounded"></div></div>'),kt=k('<div class="relative rounded-lg overflow-hidden border-2 border-input"><img class="w-full h-32 object-cover"/> <button type="button" class="absolute top-1 right-1 bg-destructive text-destructive-foreground p-1.5 rounded-full hover:bg-destructive/90 transition-colors"><!></button> <div class="absolute bottom-1 left-1 bg-black/70 text-white text-xs px-2 py-0.5 rounded"></div></div>'),It=k('<div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-4"><!> <!></div>'),Ct=k('<div class="border-2 border-dashed border-input rounded-lg p-6 text-center hover:border-primary transition-colors"><input id="coverImages" type="file" accept="image/*" multiple class="hidden"/> <label for="coverImages" class="cursor-pointer"><div class="flex flex-col items-center gap-2"><svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-foreground font-medium">Click to upload images</span> <span class="text-xs text-muted-foreground"> </span></div></label></div> <div class="flex gap-2"><input type="url" class="flex-1 px-4 py-2 border-2 border-input rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all outline-none text-sm" placeholder="Or paste image URL..."/> <button type="button" class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium">Add URL</button></div>',1),Ut=k('<p class="text-sm text-muted-foreground text-center py-4 bg-muted/50 rounded-lg">Maximum 6 images reached</p>'),Tt=k('<label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-input text-primary focus:ring-2 focus:ring-primary/20"/> <span class="text-sm"> </span></label>'),Pt=k('<span class="inline-flex items-center gap-1 px-3 py-1 bg-primary/10 text-primary rounded-full text-sm"> <button type="button" class="hover:text-destructive">Ã—</button></span>'),Rt=k('<div class="flex flex-wrap gap-2 mt-3"></div>'),Et=k('<div class="flex items-center justify-between mb-8"><h1 class="text-3xl font-bold">Edit Teaching</h1> <a href="/admin"><!></a></div> <form class="space-y-6"><div class="bg-card p-6 rounded-lg border space-y-6"><div class="space-y-2"><label for="title" class="text-sm font-medium text-foreground">Title</label> <input id="title" type="text" required class="w-full px-4 py-3 border-2 border-input rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all outline-none" placeholder="Enter your teaching title..."/></div> <div class="space-y-2"><label for="content" class="text-sm font-medium text-foreground">Content</label> <!></div> <div class="space-y-2"><label for="excerpt" class="text-sm font-medium text-foreground">Excerpt (Optional)</label> <textarea id="excerpt" rows="3" class="w-full px-4 py-3 border-2 border-input rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all outline-none resize-y" placeholder="Brief summary for preview..."></textarea></div> <div class="space-y-2"><div class="text-sm font-medium text-foreground" role="heading" aria-level="3">Cover Images (Optional - Max 6 for carousel)</div> <!> <!></div> <div class="space-y-2"><div class="text-sm font-medium text-foreground">Categories</div> <div class="grid grid-cols-2 gap-3"></div></div> <div class="space-y-2"><label for="tagInput" class="text-sm font-medium text-foreground">Tags</label> <div class="flex gap-2"><input id="tagInput" type="text" class="flex-1 px-4 py-3 border-2 border-input rounded-lg bg-background text-foreground placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all outline-none" placeholder="Add tags..."/> <!></div> <!></div> <div class="space-y-3 pt-4 border-t"><label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-input text-primary focus:ring-2 focus:ring-primary/20"/> <span class="text-sm font-medium">Publish immediately</span></label> <label class="flex items-center space-x-2 cursor-pointer"><input type="checkbox" class="w-4 h-4 rounded border-input text-primary focus:ring-2 focus:ring-primary/20"/> <span class="text-sm font-medium">Feature this post</span></label></div></div> <div class="flex justify-end gap-3"><!></div></form>',1),Ft=k('<div class="min-h-screen bg-background"><div class="container mx-auto px-4 py-8 max-w-4xl"><!></div></div>');function Xt(Se,Ae){dt(Ae,!1);const me=()=>je(ht,"$authStore",fe),ge=()=>je(_t,"$page",fe),[fe,ze]=xt(),be=c(),re=c(),De=[];let z=c(""),E=c(""),N=c(""),qe="",p=c([]),P=c(""),Y=c(!1),H=c(!1),J=c(!1),xe=c(!0),V=c(!1),T=[],b=c([]),_e=c([]),W=c([]),F=c(""),I=c([]),Ge=[],h=null;nt(async()=>{var n,d;try{h=await O.getPostById(e(re)),h&&(r(z,h.title),r(E,h.content),r(N,h.excerpt||""),qe=h.cover_image||"",r(p,h.cover_images||[]),r(Y,h.published),r(H,h.featured),r(W,((n=h.categories)==null?void 0:n.map(i=>i.id))||[]),r(I,((d=h.tags)==null?void 0:d.map(i=>i.name))||[])),r(_e,await O.getCategories()),Ge=await O.getTags()}catch(i){console.error("Error loading post:",i),w.error("Failed to load post"),Be("/admin")}finally{r(xe,!1)}});function he(){e(F).trim()&&!e(I).includes(e(F).trim())&&(r(I,[...e(I),e(F).trim()]),r(F,""))}function Oe(n){r(I,e(I).filter(d=>d!==n))}async function Ne(n){const i=n.target.files;if(!(!i||i.length===0)){if(T.length+i.length>6){w.error("You can upload maximum 6 images");return}for(const y of Array.from(i)){if(!y.type.startsWith("image/")){w.error(`${y.name} is not an image file`);continue}if(y.size>5*1024*1024){w.error(`${y.name} is larger than 5MB`);continue}T=[...T,y];const M=new FileReader;M.onload=D=>{var j;r(b,[...e(b),(j=D.target)==null?void 0:j.result])},M.readAsDataURL(y)}}}function Ye(n){T=T.filter((d,i)=>i!==n),r(b,e(b).filter((d,i)=>i!==n))}function He(n){r(p,e(p).filter((d,i)=>i!==n))}function Je(){if(e(P).trim()){if(e(p).length>=6){w.error("Maximum 6 images allowed");return}r(p,[...e(p),e(P).trim()]),r(P,"")}}async function Ve(n){if(n.preventDefault(),!e(be)){w.error("You must be logged in to edit a post");return}if(!e(z).trim()||!e(E).trim()){w.error("Title and content are required");return}r(J,!0);try{let d=[...e(p)];if(T.length>0){r(V,!0);try{for(const i of T){const y=`${Date.now()}-${Math.random().toString(36).substring(7)}-${i.name}`,M=await O.uploadImage(i,y);d.push(M)}w.success(`${T.length} image(s) uploaded successfully`)}catch(i){console.error("Error uploading images:",i),w.error("Failed to upload some images")}finally{r(V,!1)}}await O.updatePost(e(re),{title:e(z),content:e(E),excerpt:e(N)||e(E).substring(0,200),published:e(Y),featured:e(H),cover_image:d[0]||"",cover_images:d.length>0?d:void 0,category_ids:e(W),tag_names:e(I),scheduled_at:null,series_id:null,series_order:null}),w.success("Teaching updated successfully!"),Be("/admin")}catch(d){console.error("Error updating post:",d),w.error(d.message||"Failed to update post")}finally{r(J,!1)}}Ee(()=>me(),()=>{r(be,me().user)}),Ee(()=>ge(),()=>{r(re,ge().params.id)}),ut(),lt();var ae=Ft();ft("sv5cz1",n=>{pt(()=>{vt.title="Edit Teaching - ChristFocus"})});var ye=o(ae),We=o(ye);{var Xe=n=>{var d=$t();f(n,d)},Ke=n=>{var d=Et(),i=Fe(d),y=s(o(i),2),M=o(y);ve(M,{variant:"outline",children:(t,l)=>{G();var u=pe("Cancel");f(t,u)},$$slots:{default:!0}}),a(y),a(i);var D=s(i,2),j=o(D),oe=o(j),$e=s(o(oe),2);S($e),a(oe);var se=s(oe,2),Qe=s(o(se),2);yt(Qe,{get content(){return e(E)},set content(t){r(E,t)},$$legacy:!0}),a(se);var ie=s(se,2),we=s(o(ie),2);mt(we),a(ie);var le=s(ie,2),ke=s(o(le),2);{var Ze=t=>{var l=It(),u=o(l);Z(u,1,()=>e(b),ee,(x,_,m)=>{var $=wt(),C=o($);A(C,"alt",`Preview ${m+1}`);var g=s(C,2);A(g,"aria-label",`Remove image ${m+1}`);var B=o(g);Le(B,{class:"w-4 h-4"}),a(g);var q=s(g,2);q.textContent=`File ${m+1}`,a($),L(()=>A(C,"src",e(_))),R("click",g,()=>Ye(m)),f(x,$)});var v=s(u,2);Z(v,1,()=>e(p),ee,(x,_,m)=>{var $=kt(),C=o($);A(C,"alt",`Cover ${m+1}`);var g=s(C,2);A(g,"aria-label",`Remove URL ${m+1}`);var B=o(g);Le(B,{class:"w-4 h-4"}),a(g);var q=s(g,2);q.textContent=`URL ${m+1}`,a($),L(()=>A(C,"src",e(_))),R("click",g,()=>He(m)),f(x,$)}),a(l),f(t,l)};Q(ke,t=>{e(b),e(p),U(()=>e(b).length>0||e(p).length>0)&&t(Ze)})}var et=s(ke,2);{var tt=t=>{var l=Ct(),u=Fe(l),v=o(u),x=s(v,2),_=o(x),m=s(o(_),4),$=o(m);a(m),a(_),a(x),a(u);var C=s(u,2),g=o(C);S(g);var B=s(g,2);a(C),L(()=>{K($,`PNG, JPG, GIF up to 5MB each (${e(b),e(p),U(()=>e(b).length+e(p).length)??""}/6)`),B.disabled=(e(P),e(b),e(p),U(()=>!e(P)||e(b).length+e(p).length>=6))}),R("change",v,Ne),te(g,()=>e(P),q=>r(P,q)),R("click",B,Je),f(t,l)},rt=t=>{var l=Ut();f(t,l)};Q(et,t=>{e(b),e(p),U(()=>e(b).length+e(p).length<6)?t(tt):t(rt,!1)})}a(le);var ne=s(le,2),Ie=s(o(ne),2);Z(Ie,5,()=>e(_e),ee,(t,l)=>{var u=Tt(),v=o(u);S(v);var x,_=s(v,2),m=o(_,!0);a(_),a(u),L(()=>{x!==(x=(e(l),U(()=>e(l).id)))&&(v.value=(v.__value=(e(l),U(()=>e(l).id)))??""),K(m,(e(l),U(()=>e(l).name)))}),bt(De,[],v,()=>(e(l),U(()=>e(l).id),e(W)),$=>r(W,$)),f(t,u)}),a(Ie),a(ne);var de=s(ne,2),ue=s(o(de),2),X=o(ue);S(X);var at=s(X,2);ve(at,{type:"button",$$events:{click:he},children:(t,l)=>{G();var u=pe("Add");f(t,u)},$$slots:{default:!0}}),a(ue);var ot=s(ue,2);{var st=t=>{var l=Rt();Z(l,5,()=>e(I),ee,(u,v)=>{var x=Pt(),_=o(x),m=s(_);a(x),L(()=>K(_,`${e(v)??""} `)),R("click",m,()=>Oe(e(v))),f(u,x)}),a(l),f(t,l)};Q(ot,t=>{e(I),U(()=>e(I).length>0)&&t(st)})}a(de);var Ce=s(de,2),ce=o(Ce),Ue=o(ce);S(Ue),G(2),a(ce);var Te=s(ce,2),Pe=o(Te);S(Pe),G(2),a(Te),a(Ce),a(j);var Re=s(j,2),it=o(Re);{let t=gt(()=>e(J)||e(V));ve(it,{type:"submit",get disabled(){return e(t)},class:"min-w-[150px]",children:(l,u)=>{G();var v=pe();L(()=>K(v,e(V)?"Uploading Image...":e(J)?"Updating...":"Update Teaching")),f(l,v)},$$slots:{default:!0}})}a(Re),a(D),te($e,()=>e(z),t=>r(z,t)),te(we,()=>e(N),t=>r(N,t)),te(X,()=>e(F),t=>r(F,t)),R("keydown",X,t=>t.key==="Enter"&&(t.preventDefault(),he())),Me(Ue,()=>e(Y),t=>r(Y,t)),Me(Pe,()=>e(H),t=>r(H,t)),R("submit",D,Ve),f(n,d)};Q(We,n=>{e(xe)?n(Xe):n(Ke,!1)})}a(ye),a(ae),f(Se,ae),ct(),ze()}export{Xt as component};
