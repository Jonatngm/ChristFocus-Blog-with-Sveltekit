import{d as i,w as n}from"./Cf1ZQmKO.js";import{s as d}from"./DzKOTJ0Y.js";function g(u){var r;return{id:u.id,email:u.email,username:((r=u.user_metadata)==null?void 0:r.username)||u.email.split("@")[0]}}function f(){const{subscribe:u,set:r,update:e}=n({user:null,loading:!0});return d.auth.getSession().then(({data:{session:a}})=>{e(t=>({user:a!=null&&a.user?g(a.user):null,loading:!1}))}),d.auth.onAuthStateChange((a,t)=>{a==="SIGNED_IN"&&(t!=null&&t.user)?e(l=>({user:g(t.user),loading:!1})):a==="SIGNED_OUT"?e(l=>({user:null,loading:!1})):a==="TOKEN_REFRESHED"&&(t!=null&&t.user)&&e(l=>({user:g(t.user),loading:l.loading}))}),{subscribe:u,login:a=>e(t=>({...t,user:a})),logout:()=>{d.auth.signOut(),e(a=>({...a,user:null}))},setLoading:a=>e(t=>({...t,loading:a}))}}const m=f();i(m,u=>u.user);i(m,u=>u.loading);export{m as a};
