import{f as B,a as x,t as M,c as ce}from"../chunks/DBbh6i71.js";import"../chunks/By_quqKy.js";import{ao as ue,af as D,ap as me,h as ve,x as fe,Z as pe,aq as be,p as he,a6 as O,b as ye,e as _e,a0 as o,$ as ge,a3 as l,a1 as n,m as a,a5 as k,a2 as Z,o as u,f as we}from"../chunks/Gv26lf99.js";import{s as T}from"../chunks/CGn5TYOr.js";import{i as ae}from"../chunks/L_eDHKqI.js";import{h as xe}from"../chunks/BgmTWRyC.js";import{r as C}from"../chunks/Dvb1pLFc.js";import{e as L}from"../chunks/DXFmX2RM.js";import{i as Se}from"../chunks/Cu4e1Vm0.js";import{g as re}from"../chunks/BwDTLcRc.js";import{a as te}from"../chunks/DXUo_fyL.js";import{s as R}from"../chunks/DzKOTJ0Y.js";import{B as F,t as V}from"../chunks/DFprynn4.js";import{C as $e}from"../chunks/DTOYTEMr.js";function I(e,t,r=t){var c=new WeakSet;ue(e,"input",async s=>{var d=s?e.defaultValue:e.value;if(d=N(e)?G(d):d,r(d),D!==null&&c.add(D),await me(),d!==(d=t())){var _=e.selectionStart,p=e.selectionEnd,S=e.value.length;if(e.value=d??"",p!==null){var P=e.value.length;_===p&&p===S&&P>S?(e.selectionStart=P,e.selectionEnd=P):(e.selectionStart=_,e.selectionEnd=Math.min(p,P))}}}),(ve&&e.defaultValue!==e.value||fe(t)==null&&e.value)&&(r(N(e)?G(e.value):e.value),D!==null&&c.add(D)),pe(()=>{var s=t();if(e===document.activeElement){var d=be??D;if(c.has(d))return}N(e)&&s===G(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function N(e){var t=e.type;return t==="number"||t==="range"}function G(e){return e===""?null:+e}const Ee=["victor@truthhub.blog"];function Oe(e){var t;return{id:e.id,email:e.email,username:((t=e.user_metadata)==null?void 0:t.username)||e.email.split("@")[0]}}class Pe{mapUser(t){return Oe(t)}async sendOtp(t){if(!Ee.includes(t.toLowerCase()))throw new Error("This email is not authorized to create an account");const{error:r}=await R.auth.signInWithOtp({email:t,options:{shouldCreateUser:!0}});if(r)throw r}async verifyOtpAndSetPassword(t,r,c,s){const{data:d,error:_}=await R.auth.verifyOtp({email:t,token:r,type:"email"});if(_)throw _;const{data:p,error:S}=await R.auth.updateUser({password:c,data:{username:s}});if(S)throw S;return p.user}async signInWithPassword(t,r){const{data:c,error:s}=await R.auth.signInWithPassword({email:t,password:r});if(s)throw s;return c.user}async signOut(){const{error:t}=await R.auth.signOut();if(t)throw t}}const W=new Pe;var ke=B('<form class="space-y-4"><div class="space-y-2"><label for="email" class="text-sm font-medium">Email</label> <input id="email" type="email" required class="w-full px-3 py-2 border rounded-md" placeholder="your@email.com"/></div> <div class="space-y-2"><label for="password" class="text-sm font-medium">Password</label> <input id="password" type="password" required class="w-full px-3 py-2 border rounded-md" placeholder="••••••••"/></div> <!> <div class="text-center text-sm"><button type="button" class="text-primary hover:underline">Need an account? Register</button></div></form>'),Ce=B('<form class="space-y-4"><div class="space-y-2"><label for="reg-email" class="text-sm font-medium">Email</label> <input id="reg-email" type="email" required class="w-full px-3 py-2 border rounded-md" placeholder="your@email.com"/></div> <!> <div class="text-center text-sm"><button type="button" class="text-primary hover:underline">Back to login</button></div></form>'),Ie=B('<form class="space-y-4"><div class="space-y-2"><label for="username" class="text-sm font-medium">Username</label> <input id="username" type="text" required class="w-full px-3 py-2 border rounded-md" placeholder="username"/></div> <div class="space-y-2"><label for="otp-code" class="text-sm font-medium">Verification Code</label> <input id="otp-code" type="text" required class="w-full px-3 py-2 border rounded-md" placeholder="123456"/></div> <div class="space-y-2"><label for="new-password" class="text-sm font-medium">Password</label> <input id="new-password" type="password" required class="w-full px-3 py-2 border rounded-md" placeholder="••••••••"/></div> <!></form>'),Ue=B('<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-muted/30 px-4 py-12"><div class="w-full max-w-md border border-border/60 rounded-lg bg-card"><div class="text-center space-y-4 p-6"><div class="flex justify-center"><div class="bg-primary/10 p-3 rounded-full"><!></div></div> <h1 class="text-2xl font-bold">Admin Access</h1> <p class="text-sm text-muted-foreground"> </p></div> <div class="p-6"><!></div></div></div>');function Ne(e,t){he(t,!1);let r=k(!1),c=k("login"),s=k(""),d=k(""),_=k(""),p=k("");async function S(m){m.preventDefault(),u(r,!0);try{const i=await W.signInWithPassword(a(s),a(d));te.login(W.mapUser(i)),re("/admin")}catch(i){i.message.includes("Invalid login credentials")?V.error("Invalid email or password"):V.error(i.message||"Login failed"),u(r,!1)}}async function P(m){m.preventDefault(),u(r,!0);try{await W.sendOtp(a(s)),V.success("Verification code sent to your email"),u(c,"otp")}catch(i){V.error(i.message||"Failed to send verification code")}finally{u(r,!1)}}async function se(m){m.preventDefault(),u(r,!0);try{const i=await W.verifyOtpAndSetPassword(a(s),a(_),a(d),a(p));te.login(W.mapUser(i)),re("/admin")}catch(i){V.error(i.message||"Registration failed"),u(r,!1)}}Se();var j=Ue();xe("1x05zx6",m=>{_e(()=>{ge.title="Login - The Truth Hub"})});var J=o(j),z=o(J),H=o(z),K=o(H),ie=o(K);$e(ie,{class:"w-8 h-8 text-primary"}),l(K),l(H);var Q=n(H,4),oe=o(Q,!0);l(Q),l(z);var X=n(z,2),le=o(X);{var de=m=>{var i=ke(),U=o(i),q=n(o(U),2);C(q),l(U);var A=n(U,2),b=n(o(A),2);C(b),l(A);var v=n(A,2);F(v,{type:"submit",class:"w-full",get disabled(){return a(r)},children:(f,$)=>{Z();var w=M();O(()=>T(w,a(r)?"Signing in...":"Sign In")),x(f,w)},$$slots:{default:!0}});var h=n(v,2),g=o(h);l(h),l(i),O(()=>{q.disabled=a(r),b.disabled=a(r)}),I(q,()=>a(s),f=>u(s,f)),I(b,()=>a(d),f=>u(d,f)),L("click",g,()=>u(c,"register")),L("submit",i,S),x(m,i)},ne=m=>{var i=ce(),U=we(i);{var q=b=>{var v=Ce(),h=o(v),g=n(o(h),2);C(g),l(h);var f=n(h,2);F(f,{type:"submit",class:"w-full",get disabled(){return a(r)},children:(E,Y)=>{Z();var y=M();O(()=>T(y,a(r)?"Sending code...":"Send Verification Code")),x(E,y)},$$slots:{default:!0}});var $=n(f,2),w=o($);l($),l(v),O(()=>g.disabled=a(r)),I(g,()=>a(s),E=>u(s,E)),L("click",w,()=>u(c,"login")),L("submit",v,P),x(b,v)},A=b=>{var v=Ie(),h=o(v),g=n(o(h),2);C(g),l(h);var f=n(h,2),$=n(o(f),2);C($),l(f);var w=n(f,2),E=n(o(w),2);C(E),l(w);var Y=n(w,2);F(Y,{type:"submit",class:"w-full",get disabled(){return a(r)},children:(y,qe)=>{Z();var ee=M();O(()=>T(ee,a(r)?"Creating account...":"Complete Registration")),x(y,ee)},$$slots:{default:!0}}),l(v),O(()=>{g.disabled=a(r),$.disabled=a(r),E.disabled=a(r)}),I(g,()=>a(p),y=>u(p,y)),I($,()=>a(_),y=>u(_,y)),I(E,()=>a(d),y=>u(d,y)),L("submit",v,se),x(b,v)};ae(U,b=>{a(c)==="register"?b(q):b(A,!1)},!0)}x(m,i)};ae(le,m=>{a(c)==="login"?m(de):m(ne,!1)})}l(X),l(J),l(j),O(()=>T(oe,a(c)==="login"?"Sign in to manage content":a(c)==="register"?"Create your account":"Enter verification code")),x(e,j),ye()}export{Ne as component};
